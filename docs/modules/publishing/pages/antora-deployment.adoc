= Antora Deployment Strategies: Root vs. Docs
:navtitle: Antora Deployment

When documenting a single repository, there are two common ways to structure your Antora project: the **Root Strategy** and the **Subfolder Strategy**.

Both work, but they have different trade-offs for local development and CI/CD.

== 1. The Root Strategy (Recommended)

In this setup, the `antora-playbook.yml` lives at the **repository root**, even if the content is in `docs/`.

*   **Structure**:
    ```text
    my-repo/
    ├── antora-playbook.yml  <-- Root
    ├── .github/workflows/docs.yml
    └── docs/
        └── antora.yml
    ```
*   **Playbook Config**:
    ```yaml
    content:
      sources:
        - url: .            # Points to the root (current dir)
          start_path: docs  # Tells Antora to look inside docs/
    ```
*   **Pros**:
    *   **CI Simplicity**: In GitHub Actions, the checkout root is `.` . The command `antora antora-playbook.yml` just works. No path overrides needed.
    *   **Clarity**: The playbook clearly defines the site for the *entire repo*.
*   **Cons**:
    *   Adds one file to your root directory.

== 2. The Subfolder Strategy (Legacy)

In this setup, everything lives inside `docs/`, including the playbook.

*   **Structure**:
    ```text
    my-repo/
    └── docs/
        ├── antora-playbook.yml  <-- Inside docs/
        └── antora.yml
    ```
*   **Playbook Config**:
    ```yaml
    content:
      sources:
        - url: ..           # MUST point to parent (git root)
          start_path: docs
    ```
*   **Pros**:
    *   Keeps the repository root clean.
*   **Cons**:
    *   **CI Complexity**: When running in CI, you are usually at the repo root.
        Running `antora docs/antora-playbook.yml` causes relative path resolution specific to where the command is *run* vs where the file *is*.
        *   If `url: .`, Antora thinks the git root is `docs/` (Wrong).
        *   If `url: ..`, Antora tries to resolve the parent of the checkout (Restricted).
    *   **Fix**: You often have to force correct paths with `--url .` CLI flags.

== Recommendation

**Use the Root Strategy.**

It aligns with how CI systems view your repository (as a unit). The slight "clutter" of one file at the root is worth the stability in deployment pipelines.

== Multi-Repository Handling

Your question is: *Does this hold up when referencing other git repositories?*

**Yes, and it actually makes local development easier.**

In a multi-repo site (like the main Dev Center), you have two distinct needs:

=== 1. The Production/CI Need (Remote URLs)
In your main production playbook (e.g., `the-dev-center/docs/antora-playbook.yml`), you should use **Full GitHub URLs**. This is the only way for GitHub Actions to fetch all the pieces.

[source,yaml]
----
content:
  sources:
    - url: https://github.com/the-dev-center/msi-generator.git
      branches: HEAD
      start_path: docs
----

=== 2. The Local Development Need (Relative Paths)
When working locally, cloning is slow. You want to point to your sibling folders on your hard drive.

*   **Root Strategy**: Siblings are at `../sibling-repo`.
*   **Subfolder Strategy**: Siblings are at `../../sibling-repo`.

By using the **Root Strategy**, your local dev references are cleaner and match the standard "folder per project" structure of most developers.

=== The "Best of Both Worlds" Solution

Do not manually toggle URLs in your main playbook. Instead, use a **Local Dev Playbook Extension**.

1.  Create `local-antora-playbook.yml` (and Git-ignore it).
2.  Define only the local overrides:

[source,yaml]
----
extends: ./antora-playbook.yml
content:
  sources:
    - url: ../msi-generator
      branches: HEAD
      start_path: docs
----

3.  Run locally with: `antora local-antora-playbook.yml`.

This keeps your **Root Strategy** intact for the repo's specific CI, while allowing the global "hub" site to aggregate everything seamlessly.

== GitHub Pages Configuration

Regardless of strategy, deployment is the same:

1.  **Build**: Antora generates a static site (default: `build/site` or `public/`).
2.  **Upload**: Upload this folder to the `gh-pages` branch.
3.  **Configure**: Set GitHub Pages to deploy from `gh-pages` / `root`.


